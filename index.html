<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Toastmasters Timer â€” FTH Ready</title>
<!-- Simple favicon depicting a timer hand -->
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cg fill='none'%3E%3Ccircle cx='32' cy='32' r='30' stroke='%23004165' stroke-width='4'/%3E%3Cpath d='M32 14v18l10 6' stroke='%23ff0000' stroke-width='5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/g%3E%3C/svg%3E"/>
<style>
  :root{
    /* Toastmasters brand palette */
    --tm-maroon:#772432; --tm-blue:#004165;
    --tm-gray:#A9B2B1;  --tm-yellow:#F2DF74;
    --white:#fff; --black:#111;
    /* vivid timer square colours */
    --green: rgba(0,200,0,.50);
    --yellow: rgba(255,215,0,.60);
    --red: rgba(255,0,0,.50);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;color:var(--black);background:#fafbfc}
  header{
    background:linear-gradient(90deg,var(--tm-blue),var(--tm-maroon));
    color:#fff; padding:12px 16px; display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    box-shadow:0 2px 10px rgba(0,0,0,.15);
  }
  .brand{display:flex;align-items:center;gap:10px;font-weight:800}
  .badge{width:34px;height:34px;border-radius:50%;display:grid;place-items:center;background:var(--tm-yellow);color:#222;font-weight:900}
  .btn{appearance:none;border:0;border-radius:12px;padding:9px 12px;font-weight:700;cursor:pointer;background:#fff;color:#222;box-shadow:0 2px 6px rgba(0,0,0,.12)}
  .btn[disabled]{opacity:.5;cursor:not-allowed;filter:grayscale(20%)}
  .btn.primary{background:var(--tm-yellow)}
  main{max-width:1120px;margin:18px auto;padding:0 14px;display:grid;gap:16px}
  .grid{display:grid;grid-template-columns:1.05fr .95fr;gap:16px}
  @media (max-width: 980px){.grid{grid-template-columns:1fr}}
  .card{background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.08);overflow:hidden}
  .face{position:relative;min-height:360px;display:grid;place-items:center;background:#f3f6f9;overflow:hidden}
  .square{
    position:absolute;top:50%;left:50%;
    width:min(90%,520px);height:auto;aspect-ratio:1/1;
    transform:translate(-50%,-50%);
    border-radius:18px;background:transparent;transition:background-color .28s ease;
    pointer-events:none;
  }
  .digits{position:relative;font-weight:900;letter-spacing:1px;font-size:clamp(3rem,10vw,7.4rem);text-shadow:0 2px 0 rgba(255,255,255,.85);user-select:none}
  .chip{position:absolute;right:12px;top:12px;background:rgba(255,255,255,.92);border-radius:999px;padding:6px 10px;font-weight:800;box-shadow:0 2px 8px rgba(0,0,0,.12)}
  .panel{padding:14px;border-top:4px solid var(--tm-blue);display:grid;gap:12px}
  .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  label{font-weight:800}
  input[type='text'], select{padding:9px 10px;border:1px solid #d5dbe3;border-radius:10px;min-width:120px}
  input[disabled]{background:#f3f3f3;color:#666}
  .kbd{display:inline-block;border:1px solid #d0d4da;border-bottom-width:2px;border-radius:6px;padding:2px 6px;font-family:ui-monospace,Consolas,Menlo,monospace}
  .help{font-size:.92rem;color:#444;background:#f6f7f9;border-left:4px solid var(--tm-maroon);padding:10px;border-radius:8px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px 10px;border-bottom:1px solid #e8ecf1;text-align:left}
  th{background:#f1f4f8}
  .q-badge{display:inline-block;padding:4px 10px;border-radius:999px;font-weight:800;cursor:pointer}
  .q-yes{background:var(--yellow);color:#222}
  .q-no{background:rgba(255,0,0,.18);color:#b00000;border:1px solid #f3b3b3}
  @media print{
    header,.timerWrap,.controls,.help,.no-print{display:none!important}
    .recordsWrap{box-shadow:none;border:0}
    body{background:#fff}
  }
</style>
</head>
<body>
  <header>
    <div class="brand"><div class="badge">TM</div><div>Toastmasters Timer</div></div>
    <div class="row controls">
      <button id="btn-print" class="btn" title="Export to PDF">Export PDF</button>
      <button id="reset" class="btn" title="Reset">Reset</button>
      <button id="start" class="btn primary" title="Start" disabled>Start</button>
    </div>
  </header>

  <main>
    <div class="grid">
      <!-- Timer area -->
      <section class="card timerWrap" id="tm-focus" tabindex="0" aria-label="Timer">
        <div class="face" id="face">
          <div class="square" id="square"></div>
          <div class="chip" id="status">Ready</div>
          <div class="digits" id="digits">00:00</div>
        </div>
        <div class="panel">
          <div class="row">
            <label>Speaker Name</label>
            <input id="speaker" type="text" placeholder="e.g., Jane Doe" autocomplete="off"/>
            <button id="mark" class="btn" title="Mark a split">Mark</button>
            <button id="addRecord" class="btn" title="Add to table">Add Record</button>
          </div>
          <div class="row">
            <label for="preset">Preset</label>
            <select id="preset">
              <option value="TT">Table Topics Â· 1â€“2</option>
              <option value="EV">Evaluation Â· 2â€“3</option>
              <option value="S57">Speech Â· 5â€“7</option>
              <option value="S79">Speech Â· 7â€“9</option>
            </select>
            <label>Green</label><input id="gMin" type="text" value="01:00" disabled title="Set by preset"/>
            <label>Yellow</label><input id="yMin" type="text" value="01:30" disabled title="Set by preset"/>
            <label>Red</label><input id="rMin" type="text" value="02:00" disabled title="Set by preset"/>
          </div>
          <div class="help">
            <span class="kbd">Space</span> start/pause Â· <span class="kbd">R</span> reset Â·
            <span class="kbd">F</span> fullscreen Â· <span class="kbd">1â€“4</span> presets (1=TT,2=EV,3=5-7,4=7-9)<br/>
            Always counts up from 0:00. Name is required to enable Start.
          </div>
        </div>
      </section>
      <!-- Records area -->
      <section class="card recordsWrap">
        <div class="panel">
          <div class="row"><strong>Recorded Times</strong> <span class="muted">(click the badge to toggle Qualified)</span></div>
          <table id="records">
            <thead><tr><th>#</th><th>Speaker</th><th>Speech Type</th><th>Time</th><th>Qualified</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </div>
  </main>

<script>
/* Encapsulated timer logic */
(function(){
  const $ = id => document.getElementById(id);
  const pad = n => (n<10?'0':'')+n;
  const toSec = mmss => { const [m,s]=(mmss||'0:00').split(':').map(Number); return (m||0)*60 + (s||0); };
  const toMMSS = s => { s=Math.max(0,Math.round(s)); const m=Math.floor(s/60), t=s%60; return pad(m)+':'+pad(t); };
  // DOM refs
  const digits=$('digits'), square=$('square'), status=$('status');
  const gEl=$('gMin'), yEl=$('yMin'), rEl=$('rMin');
  const presetEl=$('preset'), startBtn=$('start'), resetBtn=$('reset');
  const markBtn=$('mark'), addBtn=$('addRecord'), speakerEl=$('speaker');
  const btnPrint=$('btn-print');
  const recordsTbody = $('records').querySelector('tbody');
  // Timer state
  let running=false, startTs=0, acc=0, raf=0;
  // Predefined speech presets
  const PRESETS={
    TT:{g:'01:00', y:'01:30', r:'02:00'},
    EV:{g:'02:00', y:'02:30', r:'03:00'},
    S57:{g:'05:00', y:'06:00', r:'07:00'},
    S79:{g:'07:00', y:'08:00', r:'09:00'}
  };
  function updateStartEnabled(){
    const ok=(speakerEl.value||'').trim().length>0;
    startBtn.disabled=!ok;
  }
  function savePrefs(){ localStorage.setItem('tm_timer_prefs', JSON.stringify({preset:presetEl.value})); }
  function loadPrefs(){
    try{ const p=JSON.parse(localStorage.getItem('tm_timer_prefs')||'{}'); if(p.preset && PRESETS[p.preset]) presetEl.value=p.preset; }
    catch(e){}
    applyPreset(presetEl.value,true);
  }
  function applyPreset(code,onLoad=false){
    const pre=PRESETS[code]||PRESETS.TT;
    gEl.value=pre.g; yEl.value=pre.y; rEl.value=pre.r;
    if(!onLoad) savePrefs();
    paint(0);
  }
  function thresholds(){ return { g:toSec(gEl.value), y:toSec(yEl.value), r:toSec(rEl.value) }; }
  function now(){ return performance.now(); }
  function curSec(){ const ms=running ? (acc+(now()-startTs)) : acc; return Math.floor(ms/1000); }
  function start(){
    if(startBtn.disabled){ alert('Please enter the Speaker Name before starting.'); return; }
    if(running){ pause(); return; }
    running=true; startTs=now(); status.textContent='Running'; startBtn.textContent='Pause'; tick();
  }
  function pause(){ if(!running) return; running=false; acc+=now()-startTs; cancelAnimationFrame(raf); status.textContent='Paused'; startBtn.textContent='Start'; }
  function reset(){ running=false; startTs=0; acc=0; cancelAnimationFrame(raf); status.textContent='Ready'; startBtn.textContent='Start'; paint(0); }
  function mark(){ /* record split, not shown */ }
  function paint(force=null){
    const t=thresholds();
    const s=force!==null ? force : curSec();
    digits.textContent=toMMSS(s);
    let bg='transparent';
    if(s>=t.r) bg='var(--red)';
    else if(s>=t.y) bg='var(--yellow)';
    else if(s>=t.g) bg='var(--green)';
    square.style.backgroundColor=bg;
  }
  function tick(){ paint(); raf=requestAnimationFrame(tick); }
  // Qualification: time qualifies if within [green-30s, red+30s]
  function isQualified(sec){ const t=thresholds(); const lower=Math.max(0,t.g-30); const upper=t.r+30; return sec>=lower && sec<=upper; }
  // Records list
  const records=[];
  function addRecord(){
    const code=presetEl.value;
    const name=(speakerEl.value||'').trim();
    const typeMap={TT:'Table Topics 1â€“2', EV:'Evaluation 2â€“3', S57:'Speech 5â€“7', S79:'Speech 7â€“9'};
    const type=typeMap[code]||'Speech';
    const seconds=curSec(); const mmss=toMMSS(seconds);
    const q=isQualified(seconds);
    records.push({name,type,mmss,qualified:q});
    renderRecords(); speakerEl.value=''; updateStartEnabled();
  }
  function renderRecords(){
    recordsTbody.innerHTML='';
    records.forEach((r,i)=>{
      const tr=document.createElement('tr');
      const qClass=r.qualified ? 'q-yes' : 'q-no';
      const qText=r.qualified ? 'Qualified' : 'Not Qualified';
      tr.innerHTML=`<td>${i+1}</td><td>${r.name||'-'}</td><td>${r.type}</td><td>${r.mmss}</td><td><span class="q-badge ${qClass}" data-idx="${i}">${qText}</span></td>`;
      recordsTbody.appendChild(tr);
    });
  }
  recordsTbody.addEventListener('click',(e)=>{
    const el=e.target.closest('.q-badge'); if(!el) return; const idx=+el.dataset.idx; if(isNaN(idx)) return; records[idx].qualified=!records[idx].qualified; renderRecords(); });
  // Event listeners
  presetEl.addEventListener('change',(e)=>applyPreset(e.target.value));
  startBtn.addEventListener('click',start);
  resetBtn.addEventListener('click',reset);
  markBtn.addEventListener('click',mark);
  addBtn.addEventListener('click',addRecord);
  speakerEl.addEventListener('input',updateStartEnabled);
  btnPrint.addEventListener('click',()=>window.print());
  function isTypingTarget(ev){ const t=ev.target; return t && (t.tagName==='INPUT' || t.tagName==='SELECT' || t.tagName==='TEXTAREA' || t.isContentEditable); }
  function onKey(e){
    if(e.repeat) return; if(isTypingTarget(e)) return;
    const k=e.key.toLowerCase();
    if(k===' '){ e.preventDefault(); if(startBtn.disabled){ alert('Please enter the Speaker Name before starting.'); return; } start(); }
    else if(k==='r'){ reset(); }
    else if(k==='f'){ try{ if(!document.fullscreenElement){ document.documentElement.requestFullscreen?.(); } else { document.exitFullscreen?.(); } } catch(_){} }
    else if(['1','2','3','4'].includes(k)){ const map={'1':'TT','2':'EV','3':'S57','4':'S79'}; presetEl.value=map[k]; applyPreset(map[k]); }
  }
  document.addEventListener('keydown',onKey);
  window.addEventListener('keydown',onKey);
  // Initialisation
  loadPrefs(); updateStartEnabled(); reset();
})();
</script>
</body>
</html>
